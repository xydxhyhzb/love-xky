# 表白墙共享版使用说明

## 问题描述

原始版本中，信息只能存储在浏览器的localStorage中，导致数据只能在同一台设备的同一浏览器中访问，其他人无法看到你发布的表白。

## 解决方案

我们创建了一个共享版本，使用独立的数据同步服务器，让所有连接到同一网络的人都能看到表白内容。

### 新增文件

1. **sync-server.js** - 数据同步服务器
2. **index-shared.html** - 共享版前台页面
3. **启动数据同步服务.bat** - 启动数据同步服务的脚本
4. **一键启动共享版.bat** - 一键启动所有共享版服务的脚本

### 数据同步原理

1. **数据存储**：
   - 所有表白数据保存在服务器的 `shared_data.json` 文件中
   - 不再依赖浏览器的localStorage

2. **数据访问**：
   - 通过REST API提供数据的增删改查功能
   - 支持跨域访问，允许不同设备访问

3. **实时同步**：
   - 每30秒自动同步一次数据
   - 提供手动刷新按钮
   - 显示在线/离线状态

## 使用方法

### 方法1：一键启动（推荐）

1. **双击运行 `一键启动共享版.bat`**
2. 等待自动配置并启动所有服务
3. 浏览器会自动打开三个页面：
   - 单机版前台：http://localhost:8000
   - 管理员后台：http://localhost:8001
   - 共享版前台：http://localhost:8002

### 方法2：手动启动

1. **启动数据同步服务**：
   - 双击运行 `启动数据同步服务.bat`
   - 等待服务启动

2. **启动前台和后台**：
   - 使用之前的方法启动前台和后台服务

3. **访问共享版页面**：
   - 在浏览器中打开 `D:\表白墙部署\用户前台\index-shared.html`
   - 或访问 http://localhost:8002

### 方法3：只使用共享版

1. **只启动数据同步服务**：
   - 双击运行 `启动数据同步服务.bat`
   - 等待服务启动

2. **访问共享版页面**：
   - 在浏览器中打开 `D:\表白墙部署\用户前台\index-shared.html`
   - 或访问 http://localhost:8002

## 功能特性

### 共享版前台

1. **多人可见**：
   - 所有连接到同一网络的人都能看到表白
   - 数据实时同步，无需刷新页面

2. **数据导出/导入**：
   - 支持导出所有表白数据为JSON文件
   - 支持从JSON文件导入表白数据

3. **状态显示**：
   - 右下角显示连接状态（在线/离线）
   - 提供手动同步按钮

4. **媒体支持**：
   - 支持图片和视频上传
   - 完整的媒体预览和播放功能

### 数据同步服务器

1. **REST API**：
   - GET /api/confessions：获取所有表白
   - POST /api/confessions：添加新表白

2. **跨域支持**：
   - 设置CORS头，允许跨域访问
   - 支持OPTIONS请求

3. **错误处理**：
   - 完善的错误处理和日志
   - 端口占用自动检测

## 网络访问

### 局域网访问

1. 启动服务后，局域网内任何设备都可以访问
2. 使用服务器的IP地址访问：
   - 前台：http://[服务器IP]:8002
   - 后台：http://[服务器IP]:8001

### 外网访问

1. 需要配置防火墙和路由器端口转发
2. 使用网络诊断工具进行配置
3. 外网访问地址：
   - 前台：http://[公网IP]:8002
   - 后台：http://[公网IP]:8001

## 数据管理

### 导出数据

1. 在共享版页面点击"导出数据"按钮
2. 浏览器会自动下载一个JSON文件
3. 文件包含所有表白数据，包括图片和视频

### 导入数据

1. 在共享版页面点击"导入数据"按钮
2. 选择之前导出的JSON文件
3. 数据会被逐条添加到共享服务器

### 备份数据

1. 定期备份 `shared_data.json` 文件
2. 文件位置：`D:\表白墙部署\用户前台\shared_data.json`
3. 可以直接复制此文件作为备份

## 注意事项

1. **数据持久性**：
   - 共享版数据保存在服务器上，不会因浏览器关闭而丢失
   - 但服务器文件被删除会导致数据丢失

2. **网络依赖**：
   - 需要数据同步服务器运行才能正常工作
   - 如果服务器离线，只能看到缓存的数据

3. **并发控制**：
   - 当前版本没有实现复杂的并发控制
   - 极少数情况下可能出现数据不一致

4. **性能考虑**：
   - 数据量过大时可能影响加载速度
   - 图片和视频数据会显著增加数据量

## 问题排查

### 无法连接数据同步服务器

1. 检查服务器是否已启动
2. 检查端口8002是否被占用
3. 检查防火墙设置

### 数据不显示

1. 检查网络连接状态
2. 点击"同步数据"按钮手动同步
3. 查看浏览器控制台错误信息

### 文件上传失败

1. 检查文件大小是否超过50MB限制
2. 检查文件格式是否支持
3. 检查网络连接是否稳定

## 总结

使用共享版可以让所有人看到表白信息，不再局限于单个设备或浏览器。只需要启动数据同步服务器，然后访问共享版页面即可。

对于需要长期保存数据的场景，建议定期备份 `shared_data.json` 文件，防止数据丢失。