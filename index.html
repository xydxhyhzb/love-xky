<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­è¡¨ç™½å¢™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .header button {
            color: white;
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .header button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .post-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .post-form h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .wall-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .wall-container h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .filter-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .confession-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .confession-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .confession-card.love {
            border-left-color: #e91e63;
            background: linear-gradient(135deg, #f8f9fa 0%, #fce4ec 100%);
        }

        .confession-card.friendship {
            border-left-color: #4caf50;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e8 100%);
        }

        .confession-card.admiration {
            border-left-color: #ff9800;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff3e0 100%);
        }

        .confession-card.thanks {
            border-left-color: #9c27b0;
            background: linear-gradient(135deg, #f8f9fa 0%, #f3e5f5 100%);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-to {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .card-type {
            font-size: 1.5rem;
        }

        .card-content {
            margin-bottom: 15px;
            line-height: 1.6;
            color: #555;
        }

        .card-from {
            font-style: italic;
            color: #888;
            text-align: right;
        }

        .card-time {
            font-size: 0.8rem;
            color: #aaa;
            text-align: right;
            margin-top: 10px;
        }

        .empty-wall {
            text-align: center;
            color: #888;
            font-size: 1.2rem;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .wall {
                grid-template-columns: 1fr;
            }
            
            .filter-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }
        }

        /* ä¸Šä¼ ç»„ä»¶æ ·å¼ */
        .upload-container {
            margin-top: 10px;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #e8f0fe;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.7;
        }

        .upload-text p {
            margin: 0 0 5px 0;
            font-weight: bold;
            color: #333;
        }

        .upload-text small {
            color: #888;
            font-size: 0.85rem;
        }

        .preview-container {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .preview-item:hover {
            transform: translateY(-2px);
        }

        .preview-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .preview-video {
            width: 120px;
            height: 120px;
            background: #000;
            display: block;
            object-fit: cover;
        }

        .video-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            overflow: hidden;
            border-radius: 8px;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
            pointer-events: none;
        }

        .video-loading {
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        .file-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 8px;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .file-info span:first-child {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-info span:last-child {
            opacity: 0.8;
            font-size: 10px;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .remove-btn:hover {
            background: #e74c3c;
            color: white;
        }

        /* è¡¨ç™½å¡ç‰‡ä¸­çš„åª’ä½“å†…å®¹ */
        .card-media {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
        }

        .card-media img,
        .card-media video {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            display: block;
        }

        /* åª’ä½“å¯ç‚¹å‡»æ•ˆæœ */
        .media-clickable {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .media-clickable:hover {
            transform: scale(1.02);
        }

        .media-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .media-clickable:hover .media-overlay {
            opacity: 1;
        }

        .media-icon {
            font-size: 24px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ç›¸å†Œå¼¹çª—æ ·å¼ */
        .media-gallery {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .gallery-content {
            width: 80%;
            max-width: 900px;
            height: 80%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .gallery-media {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .gallery-controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            margin-top: 20px;
        }

        .gallery-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .gallery-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .gallery-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gallery-close:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .gallery-info {
            color: white;
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ’• æ ¡å›­è¡¨ç™½å¢™</h1>
            <p>å‹‡æ•¢è¡¨è¾¾ä½ çš„å¿ƒæ„ï¼Œè®©çˆ±ä¼ é€’æ•´ä¸ªæ ¡å›­</p>
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button id="historyBtn" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 14px; border: none; cursor: pointer;">
                    ğŸ“œ å†å²æ¶ˆæ¯
                </button>
                <button id="refreshBtn" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 14px; border: none; cursor: pointer;">
                    ğŸ”„ åˆ·æ–°è¡¨ç™½
                </button>
                <a href="../ç®¡ç†å‘˜åå°/index.html" target="_blank" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 14px;">
                    ğŸ” ç®¡ç†å‘˜åå°
                </a>
            </div>
        </header>

        <div class="post-form">
            <h2>å‘å¸ƒè¡¨ç™½</h2>
            <form id="confessionForm">
                <div class="form-group">
                    <label for="to">è‡´ï¼š</label>
                    <input type="text" id="to" placeholder="å¯¹æ–¹çš„å§“åæˆ–æ˜µç§°" required>
                </div>
                <div class="form-group">
                    <label for="from">æ¥è‡ªï¼š</label>
                    <input type="text" id="from" placeholder="ä½ çš„å§“åæˆ–æ˜µç§°ï¼ˆå¯é€‰ï¼‰">
                </div>
                <div class="form-group">
                    <label for="content">è¡¨ç™½å†…å®¹ï¼š</label>
                    <textarea id="content" placeholder="å†™ä¸‹ä½ æƒ³è¯´çš„è¯..." rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>ä¸Šä¼ å›¾ç‰‡/è§†é¢‘ï¼š</label>
                    <div class="upload-container">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">ğŸ“</div>
                            <div class="upload-text">
                                <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                                <small>æ”¯æŒå›¾ç‰‡(JPG, PNG, GIF)å’Œè§†é¢‘(MP4, WebM, AVI, MOVç­‰)ï¼Œæœ€å¤§50MB</small>
                            </div>
                            <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display: none;">
                        </div>
                        <div id="previewContainer" class="preview-container">
                            <!-- é¢„è§ˆæ–‡ä»¶å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="type">è¡¨ç™½ç±»å‹ï¼š</label>
                    <select id="type">
                        <option value="love">ğŸ’˜ çˆ±æƒ…è¡¨ç™½</option>
                        <option value="friendship">ğŸ¤ å‹æƒ…è¡¨ç™½</option>
                        <option value="admiration">ğŸŒŸ æ¬£èµè¡¨ç™½</option>
                        <option value="thanks">ğŸ™ æ„Ÿè°¢è¡¨ç™½</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">å‘å¸ƒè¡¨ç™½</button>
            </form>
        </div>

        <div class="wall-container">
            <h2>è¡¨ç™½å¢™</h2>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="love">ğŸ’˜ çˆ±æƒ…</button>
                <button class="filter-btn" data-filter="friendship">ğŸ¤ å‹æƒ…</button>
                <button class="filter-btn" data-filter="admiration">ğŸŒŸ æ¬£èµ</button>
                <button class="filter-btn" data-filter="thanks">ğŸ™ æ„Ÿè°¢</button>
            </div>
            <div id="wall" class="wall">
                <div class="empty-wall">æš‚æ— è¡¨ç™½ï¼Œå¿«æ¥åšç¬¬ä¸€ä¸ªå‘å¸ƒè€…å§ï¼</div>
            </div>
        </div>
    </div>

    <!-- åª’ä½“ç›¸å†Œå¼¹çª— -->
    <div id="media-gallery" class="media-gallery">
        <button class="gallery-close">&times;</button>
        <div class="gallery-content">
            <img id="gallery-image" class="gallery-media" style="display: none;">
            <video id="gallery-video" class="gallery-media" controls style="display: none;"></video>
            <div class="gallery-info">
                <span id="gallery-title">æ–‡ä»¶åç§°</span>
                <span id="gallery-index">1 / 1</span>
            </div>
            <div class="gallery-controls">
                <button class="gallery-btn gallery-prev">â€¹</button>
                <button class="gallery-btn gallery-next">â€º</button>
            </div>
        </div>
    </div>

    <script>
        class ConfessionWall {
            constructor() {
                this.confessions = this.loadConfessions();
                this.currentFilter = 'all';
                this.historyMessages = this.loadHistoryMessages();
                this.selectedFiles = [];
                this.gallery = {
                    mediaList: [],
                    currentIndex: 0
                };
                this.init();
            }

            // åˆå§‹åŒ–åº”ç”¨
            init() {
                this.bindEvents();
                this.renderWall();
                
                // æ·»åŠ è°ƒè¯•ä¿¡æ¯
                console.log('åˆå§‹åŒ–è¡¨ç™½å¢™ï¼Œå½“å‰è¡¨ç™½æ•°é‡:', this.confessions.length);
                
                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
                this.debugLocalStorage();
            }
            
            // è°ƒè¯•æœ¬åœ°å­˜å‚¨
            debugLocalStorage() {
                const storageKeys = Object.keys(localStorage);
                console.log('æœ¬åœ°å­˜å‚¨ä¸­çš„é”®:', storageKeys);
                
                // æ£€æŸ¥æ¯ä¸ªå¯èƒ½çš„æ•°æ®é”®
                const possibleKeys = ['confessions', 'frontend_confessions', 'user_confessions'];
                possibleKeys.forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            const parsed = JSON.parse(data);
                            console.log(`é”® "${key}" åŒ…å« ${parsed.length} æ¡è¡¨ç™½`);
                        } catch (e) {
                            console.error(`è§£æé”® "${key}" å¤±è´¥:`, e);
                        }
                    } else {
                        console.log(`é”® "${key}" ä¸ºç©º`);
                    }
                });
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // è¡¨å•æäº¤äº‹ä»¶
                document.getElementById('confessionForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitConfession();
                });

                // è¿‡æ»¤å™¨æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.setFilter(e.target.dataset.filter);
                    });
                });
                
                // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                this.setupFileUpload();
                
                // åª’ä½“ç›¸å†Œäº‹ä»¶
                this.setupMediaGallery();
                
                // åˆ·æ–°æŒ‰é’®äº‹ä»¶
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.refreshConfessions();
                });
                
                // å†å²æŒ‰é’®äº‹ä»¶
                document.getElementById('historyBtn').addEventListener('click', () => {
                    this.showHistory();
                });
            }

            // è®¾ç½®åª’ä½“ç›¸å†ŒåŠŸèƒ½
            setupMediaGallery() {
                const gallery = document.getElementById('media-gallery');
                const closeBtn = gallery.querySelector('.gallery-close');
                const prevBtn = gallery.querySelector('.gallery-prev');
                const nextBtn = gallery.querySelector('.gallery-next');

                // å…³é—­ç›¸å†Œ
                closeBtn.addEventListener('click', () => {
                    this.closeMediaGallery();
                });

                // ç‚¹å‡»èƒŒæ™¯å…³é—­ç›¸å†Œ
                gallery.addEventListener('click', (e) => {
                    if (e.target === gallery) {
                        this.closeMediaGallery();
                    }
                });

                // ESCé”®å…³é—­ç›¸å†Œ
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && gallery.style.display === 'flex') {
                        this.closeMediaGallery();
                    }
                });

                // ä¸Šä¸€å¼ /ä¸‹ä¸€å¼ 
                prevBtn.addEventListener('click', () => {
                    this.navigateGallery(-1);
                });

                nextBtn.addEventListener('click', () => {
                    this.navigateGallery(1);
                });
            }

            // æ‰“å¼€åª’ä½“ç›¸å†Œ
            openMediaGallery(confession, startIndex = 0) {
                const gallery = document.getElementById('media-gallery');
                const galleryImage = document.getElementById('gallery-image');
                const galleryVideo = document.getElementById('gallery-video');
                
                // æ”¶é›†æ‰€æœ‰åª’ä½“æ–‡ä»¶
                this.gallery.mediaList = [];
                
                if (confession.media && confession.media.length > 0) {
                    confession.media.forEach((file, index) => {
                        this.gallery.mediaList.push({
                            type: file.type,
                            url: file.data,
                            name: file.name,
                            confession: confession
                        });
                    });
                }
                
                if (this.gallery.mediaList.length === 0) {
                    return;
                }
                
                // è®¾ç½®å½“å‰ç´¢å¼•
                this.gallery.currentIndex = Math.min(startIndex, this.gallery.mediaList.length - 1);
                
                // æ˜¾ç¤ºç›¸å†Œ
                gallery.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // æ˜¾ç¤ºå½“å‰åª’ä½“
                this.updateGalleryMedia();
            }

            // æ›´æ–°ç›¸å†Œä¸­çš„åª’ä½“
            updateGalleryMedia() {
                const galleryImage = document.getElementById('gallery-image');
                const galleryVideo = document.getElementById('gallery-video');
                const galleryTitle = document.getElementById('gallery-title');
                const galleryIndex = document.getElementById('gallery-index');
                
                if (this.gallery.mediaList.length === 0) return;
                
                const currentMedia = this.gallery.mediaList[this.gallery.currentIndex];
                
                // æ›´æ–°ç´¢å¼•ä¿¡æ¯
                galleryIndex.textContent = `${this.gallery.currentIndex + 1} / ${this.gallery.mediaList.length}`;
                
                // æ˜¾ç¤ºæ–‡ä»¶å
                galleryTitle.textContent = currentMedia.name;
                
                if (currentMedia.type.startsWith('image/')) {
                    // æ˜¾ç¤ºå›¾ç‰‡
                    galleryImage.src = currentMedia.url;
                    galleryImage.style.display = 'block';
                    galleryVideo.style.display = 'none';
                } else if (currentMedia.type.startsWith('video/')) {
                    // æ˜¾ç¤ºè§†é¢‘
                    galleryVideo.src = currentMedia.url;
                    galleryVideo.style.display = 'block';
                    galleryImage.style.display = 'none';
                }
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
                this.updateGalleryControls();
            }

            // æ›´æ–°ç›¸å†Œæ§åˆ¶æŒ‰é’®çŠ¶æ€
            updateGalleryControls() {
                const prevBtn = document.getElementById('media-gallery').querySelector('.gallery-prev');
                const nextBtn = document.getElementById('media-gallery').querySelector('.gallery-next');
                
                prevBtn.style.opacity = this.gallery.currentIndex > 0 ? '1' : '0.5';
                prevBtn.style.pointerEvents = this.gallery.currentIndex > 0 ? 'auto' : 'none';
                
                nextBtn.style.opacity = this.gallery.currentIndex < this.gallery.mediaList.length - 1 ? '1' : '0.5';
                nextBtn.style.pointerEvents = this.gallery.currentIndex < this.gallery.mediaList.length - 1 ? 'auto' : 'none';
            }

            // ç›¸å†Œå¯¼èˆª
            navigateGallery(direction) {
                this.gallery.currentIndex += direction;
                
                // ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…
                this.gallery.currentIndex = Math.max(0, Math.min(this.gallery.currentIndex, this.gallery.mediaList.length - 1));
                
                // æ›´æ–°åª’ä½“æ˜¾ç¤º
                this.updateGalleryMedia();
            }

            // å…³é—­åª’ä½“ç›¸å†Œ
            closeMediaGallery() {
                const gallery = document.getElementById('media-gallery');
                const galleryImage = document.getElementById('gallery-image');
                const galleryVideo = document.getElementById('gallery-video');
                
                // é‡ç½®è§†é¢‘æ’­æ”¾
                galleryVideo.pause();
                galleryVideo.currentTime = 0;
                
                // éšè—ç›¸å†Œ
                gallery.style.display = 'none';
                document.body.style.overflow = '';
                
                // æ¸…é™¤æº
                galleryImage.src = '';
                galleryVideo.src = '';
            }

            // è®¾ç½®æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
            setupFileUpload() {
                console.log('è®¾ç½®æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½...');
                
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('mediaInput');
                const previewContainer = document.getElementById('previewContainer');

                if (!uploadArea || !fileInput || !previewContainer) {
                    console.error('ä¸Šä¼ å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }

                // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
                uploadArea.addEventListener('click', () => {
                    console.log('ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ');
                    fileInput.click();
                });

                // æ–‡ä»¶é€‰æ‹©å˜åŒ–äº‹ä»¶
                fileInput.addEventListener('change', (e) => {
                    console.log('æ–‡ä»¶é€‰æ‹©å˜åŒ–', e.target.files);
                    this.handleFiles(e.target.files);
                    fileInput.value = '';
                });

                // æ‹–æ‹½äº‹ä»¶
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    console.log('æ‹–æ‹½æ–‡ä»¶', e.dataTransfer.files);
                    this.handleFiles(e.dataTransfer.files);
                });

                // ç§»é™¤é¢„è§ˆé¡¹äº‹ä»¶å§”æ‰˜
                previewContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-btn')) {
                        const fileName = e.target.dataset.file;
                        this.removeFile(fileName);
                    }
                });
                
                console.log('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½è®¾ç½®å®Œæˆ');
            }

            // å¤„ç†é€‰æ‹©çš„æ–‡ä»¶
            handleFiles(files) {
                console.log('å¤„ç†æ–‡ä»¶', files);
                const MAX_SIZE = 50 * 1024 * 1024; // 50MB

                for (let file of files) {
                    console.log('å¤„ç†æ–‡ä»¶:', file.name, 'ç±»å‹:', file.type, 'å¤§å°:', file.size);
                    
                    // æ£€æŸ¥æ–‡ä»¶å¤§å°
                    if (file.size > MAX_SIZE) {
                        this.showErrorMessage(`æ–‡ä»¶"${file.name}"å¤§å°è¶…è¿‡50MBé™åˆ¶`);
                        continue;
                    }

                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
                        // æ–‡ä»¶æœ‰æ•ˆï¼Œæ·»åŠ åˆ°åˆ—è¡¨
                        if (!this.selectedFiles.find(f => f.name === file.name)) {
                            this.selectedFiles.push(file);
                            this.addFilePreview(file);
                            console.log('æ–‡ä»¶æ·»åŠ æˆåŠŸ:', file.name);
                        } else {
                            console.log('æ–‡ä»¶å·²å­˜åœ¨:', file.name);
                        }
                    } else {
                        this.showErrorMessage(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.type}`);
                        continue;
                    }
                }
                
                console.log('å½“å‰é€‰ä¸­çš„æ–‡ä»¶æ•°é‡:', this.selectedFiles.length);
            }

            // æ·»åŠ æ–‡ä»¶é¢„è§ˆ
            addFilePreview(file) {
                const previewContainer = document.getElementById('previewContainer');
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.dataset.file = file.name;

                // ä½¿ç”¨URL.createObjectURL()ç”Ÿæˆé¢„è§ˆï¼Œæ€§èƒ½æ›´å¥½
                const fileURL = URL.createObjectURL(file);
                
                if (file.type.startsWith('image/')) {
                    previewItem.innerHTML = `
                        <img src="${fileURL}" alt="${file.name}" class="preview-image">
                        <div class="file-info">
                            <span>${file.name}</span>
                            <span>${this.formatFileSize(file.size)}</span>
                        </div>
                        <button class="remove-btn" data-file="${file.name}">Ã—</button>
                    `;
                } else if (file.type.startsWith('video/')) {
                    // ä¸ºè§†é¢‘æ·»åŠ æ›´å¥½çš„æ ·å¼å’Œé”™è¯¯å¤„ç†
                    previewItem.innerHTML = `
                        <div class="video-wrapper">
                            <video class="preview-video" preload="metadata">
                                <source src="${fileURL}" type="${file.type}">
                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                            </video>
                            <div class="video-overlay">
                                <div class="video-loading">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                        <div class="file-info">
                            <span>${file.name}</span>
                            <span>${this.formatFileSize(file.size)}</span>
                        </div>
                        <button class="remove-btn" data-file="${file.name}">Ã—</button>
                    `;
                    
                    // æ·»åŠ è§†é¢‘åŠ è½½äº‹ä»¶å¤„ç†
                    const videoElement = previewItem.querySelector('video');
                    const loadingOverlay = previewItem.querySelector('.video-loading');
                    
                    videoElement.addEventListener('loadedmetadata', () => {
                        if (loadingOverlay) {
                            loadingOverlay.textContent = 'âœ…';
                            setTimeout(() => {
                                const overlay = previewItem.querySelector('.video-overlay');
                                if (overlay) overlay.style.display = 'none';
                            }, 1000);
                        }
                    });
                    
                    videoElement.addEventListener('error', (e) => {
                        console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
                        if (loadingOverlay) {
                            loadingOverlay.textContent = 'âŒ åŠ è½½å¤±è´¥';
                        }
                        this.showErrorMessage(`è§†é¢‘"${file.name}"åŠ è½½å¤±è´¥`);
                    });
                }
                
                previewContainer.appendChild(previewItem);
            }

            // ç§»é™¤æ–‡ä»¶
            removeFile(fileName) {
                this.selectedFiles = this.selectedFiles.filter(file => file.name !== fileName);
                
                // ç§»é™¤å¯¹åº”çš„é¢„è§ˆé¡¹
                const previewItem = document.querySelector(`[data-file="${fileName}"]`);
                if (previewItem) {
                    previewItem.remove();
                }
                
                console.log(`æ–‡ä»¶ ${fileName} å·²ç§»é™¤`);
            }

            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            showErrorMessage(message) {
                alert(message);
                console.error(message);
            }

            // æäº¤è¡¨ç™½
            async submitConfession() {
                const to = document.getElementById('to').value.trim();
                const from = document.getElementById('from').value.trim() || 'åŒ¿å';
                const content = document.getElementById('content').value.trim();
                const type = document.getElementById('type').value;

                if (!to || !content) {
                    alert('è¯·å¡«å†™æ¥æ”¶äººå’Œè¡¨ç™½å†…å®¹ï¼');
                    return;
                }

                // åˆ›å»ºè¡¨ç™½å¯¹è±¡
                const confession = {
                    id: Date.now(),
                    to,
                    from,
                    content,
                    type,
                    timestamp: new Date().toLocaleString('zh-CN'),
                    likes: 0,
                    media: []
                };

                // å¤„ç†æ–‡ä»¶
                if (this.selectedFiles.length > 0) {
                    for (const file of this.selectedFiles) {
                        const dataUrl = await this.fileToDataURL(file);
                        confession.media.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: dataUrl
                        });
                    }
                }

                // æ·»åŠ åˆ°è¡¨ç™½åˆ—è¡¨
                this.confessions.unshift(confession);
                this.saveConfessions();
                this.renderWall();

                // æ¸…ç©ºè¡¨å•å’Œé¢„è§ˆ
                document.getElementById('confessionForm').reset();
                document.getElementById('previewContainer').innerHTML = '';
                this.selectedFiles = [];

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                this.showSuccessMessage();
            }

            // å°†æ–‡ä»¶è½¬æ¢ä¸ºDataURL
            fileToDataURL(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showSuccessMessage() {
                const successMsg = document.createElement('div');
                successMsg.textContent = 'è¡¨ç™½å‘å¸ƒæˆåŠŸï¼';
                successMsg.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(40, 167, 69, 0.9);
                    color: white;
                    padding: 20px 40px;
                    border-radius: 10px;
                    font-size: 18px;
                    z-index: 1000;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                `;
                
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.style.opacity = '0';
                    successMsg.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        document.body.removeChild(successMsg);
                    }, 500);
                }, 2000);
            }

            // è®¾ç½®è¿‡æ»¤å™¨
            setFilter(filter) {
                this.currentFilter = filter;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    if (btn.dataset.filter === filter) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // é‡æ–°æ¸²æŸ“è¡¨ç™½å¢™
                this.renderWall();
            }

            // æ¸²æŸ“è¡¨ç™½å¢™
            renderWall() {
                const wall = document.getElementById('wall');
                
                // è¿‡æ»¤è¡¨ç™½
                const filteredConfessions = this.currentFilter === 'all' 
                    ? this.confessions 
                    : this.confessions.filter(confession => confession.type === this.currentFilter);
                
                if (filteredConfessions.length === 0) {
                    // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æ•°æ®
                    if (this.confessions.length === 0) {
                        wall.innerHTML = `
                            <div class="empty-wall">
                                <div style="margin-bottom: 20px;">æš‚æ— è¡¨ç™½ï¼Œå¿«æ¥åšç¬¬ä¸€ä¸ªå‘å¸ƒè€…å§ï¼</div>
                                <button onclick="confessionWall.tryRecoverData()" style="background: #ff9a9e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                    å°è¯•æ¢å¤æ•°æ®
                                </button>
                                <button onclick="confessionWall.clearAllData()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    æ¸…ç©ºæ‰€æœ‰æ•°æ®
                                </button>
                                <div style="margin-top: 15px; font-size: 14px; color: #888;">
                                    å¦‚æœæ‚¨ä¹‹å‰æœ‰æ•°æ®ä½†ç°åœ¨çœ‹ä¸è§ï¼Œå¯èƒ½æ˜¯æ•°æ®å­˜å‚¨é—®é¢˜ã€‚è¯·å°è¯•æ¢å¤æ•°æ®æˆ–æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ã€‚
                                </div>
                            </div>
                        `;
                    } else {
                        wall.innerHTML = '<div class="empty-wall">å½“å‰åˆ†ç±»ä¸‹æš‚æ— è¡¨ç™½</div>';
                    }
                    return;
                }
                
                wall.innerHTML = '';
                
                filteredConfessions.forEach(confession => {
                    const card = this.createConfessionCard(confession);
                    wall.appendChild(card);
                });
            }
            
            // å°è¯•æ¢å¤æ•°æ®
            tryRecoverData() {
                console.log('å°è¯•æ¢å¤æ•°æ®...');
                
                // å°è¯•ä»æ‰€æœ‰å¯èƒ½çš„localStorageé”®æ¢å¤æ•°æ®
                const allKeys = Object.keys(localStorage);
                const dataKeys = allKeys.filter(key => 
                    key.includes('confession') || key.includes('message')
                );
                
                console.log('æ‰¾åˆ°çš„æ•°æ®é”®:', dataKeys);
                
                let recoveredData = [];
                
                dataKeys.forEach(key => {
                    try {
                        const data = localStorage.getItem(key);
                        if (data) {
                            const parsed = JSON.parse(data);
                            if (Array.isArray(parsed) && parsed.length > 0) {
                                console.log(`ä» ${key} æ¢å¤ ${parsed.length} æ¡æ•°æ®`);
                                recoveredData = recoveredData.concat(parsed);
                            }
                        }
                    } catch (e) {
                        console.error(`æ¢å¤ ${key} å¤±è´¥:`, e);
                    }
                });
                
                if (recoveredData.length > 0) {
                    // å»é‡ï¼ˆåŸºäºIDï¼‰
                    const uniqueData = [];
                    const seenIds = new Set();
                    
                    recoveredData.forEach(item => {
                        if (!seenIds.has(item.id)) {
                            seenIds.add(item.id);
                            uniqueData.push(item);
                        }
                    });
                    
                    // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                    uniqueData.sort((a, b) => {
                        const timeA = new Date(a.timestamp || 0).getTime();
                        const timeB = new Date(b.timestamp || 0).getTime();
                        return timeB - timeA;
                    });
                    
                    this.confessions = uniqueData;
                    this.saveConfessions();
                    this.renderWall();
                    
                    alert(`æˆåŠŸæ¢å¤ ${uniqueData.length} æ¡è¡¨ç™½æ•°æ®ï¼`);
                } else {
                    alert('æœªæ‰¾åˆ°å¯æ¢å¤çš„æ•°æ®ï¼Œå¯èƒ½æ•°æ®å·²æ°¸ä¹…ä¸¢å¤±ã€‚');
                }
            }
            
            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            clearAllData() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    // æ¸…ç©ºæ‰€æœ‰å¯èƒ½çš„æ•°æ®é”®
                    const allKeys = Object.keys(localStorage);
                    const dataKeys = allKeys.filter(key => 
                        key.includes('confession') || key.includes('message')
                    );
                    
                    dataKeys.forEach(key => {
                        localStorage.removeItem(key);
                    });
                    
                    this.confessions = [];
                    this.renderWall();
                    
                    alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
                }
            }

            // åˆ›å»ºè¡¨ç™½å¡ç‰‡
            createConfessionCard(confession) {
                const card = document.createElement('div');
                card.className = `confession-card ${confession.type}`;
                
                // è·å–ç±»å‹æ ‡ç­¾
                const typeLabels = {
                    love: 'ğŸ’˜ çˆ±æƒ…è¡¨ç™½',
                    friendship: 'ğŸ¤ å‹æƒ…è¡¨ç™½',
                    admiration: 'ğŸŒŸ æ¬£èµè¡¨ç™½',
                    thanks: 'ğŸ™ æ„Ÿè°¢è¡¨ç™½'
                };
                
                const typeIcons = {
                    love: 'ğŸ’˜',
                    friendship: 'ğŸ¤',
                    admiration: 'ğŸŒŸ',
                    thanks: 'ğŸ™'
                };
                
                // åˆ›å»ºåª’ä½“å†…å®¹
                let mediaHTML = '';
                if (confession.media && confession.media.length > 0) {
                    // åˆ›å»ºåª’ä½“é¢„è§ˆç½‘æ ¼
                    let mediaGridHTML = '<div class="card-media">';
                    
                    // é™åˆ¶é¢„è§ˆæ•°é‡ï¼Œå¦‚æœè¶…è¿‡3ä¸ªæ˜¾ç¤ºç½‘æ ¼ï¼Œå¦åˆ™æ˜¾ç¤ºå®Œæ•´å¤§å°
                    const previewCount = Math.min(confession.media.length, 3);
                    
                    confession.media.forEach((file, index) => {
                        if (file.type.startsWith('image/')) {
                            // å›¾ç‰‡é¢„è§ˆ
                            if (confession.media.length === 1) {
                                // å•å¼ å›¾ç‰‡ï¼Œæ˜¾ç¤ºå¤§å›¾
                                mediaGridHTML += `<img src="${file.data}" alt="${file.name}" class="media-clickable" data-index="${index}">`;
                            } else {
                                // å¤šå¼ å›¾ç‰‡ï¼Œæ˜¾ç¤ºç½‘æ ¼
                                mediaGridHTML += `<img src="${file.data}" alt="${file.name}" class="media-clickable" data-index="${index}">`;
                            }
                        } else if (file.type.startsWith('video/')) {
                            // è§†é¢‘é¢„è§ˆ
                            if (confession.media.length === 1) {
                                // å•ä¸ªè§†é¢‘ï¼Œæ˜¾ç¤ºå¤§è§†é¢‘
                                mediaGridHTML += `<video src="${file.data}" class="media-clickable" data-index="${index}" onclick="event.preventDefault();"></video>`;
                            } else {
                                // å¤šä¸ªè§†é¢‘ï¼Œæ˜¾ç¤ºç¼©ç•¥å›¾
                                mediaGridHTML += `<video src="${file.data}" class="media-clickable" data-index="${index}" onclick="event.preventDefault();"></video>`;
                            }
                        }
                    });
                    
                    mediaGridHTML += '</div>';
                    mediaHTML = mediaGridHTML;
                }
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-to">è‡´ ${confession.to}</div>
                        <div class="card-type">${typeIcons[confession.type]}</div>
                    </div>
                    <div class="card-content">
                        <p>${confession.content}</p>
                    </div>
                    ${mediaHTML}
                    <div class="card-from">â€”â€” ${confession.from}</div>
                    <div class="card-time">${confession.timestamp}</div>
                `;
                
                // ä¸ºåª’ä½“å…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶
                if (confession.media && confession.media.length > 0) {
                    card.querySelectorAll('.media-clickable').forEach((element, index) => {
                        element.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.openMediaGallery(confession, index);
                        });
                    });
                }
                
                return card;
            }

            // ä¿å­˜è¡¨ç™½åˆ°æœ¬åœ°å­˜å‚¨
            saveConfessions() {
                // åŒæ—¶ä¿å­˜åˆ°å¤šä¸ªé”®ï¼Œç¡®ä¿å…¼å®¹æ€§
                const data = JSON.stringify(this.confessions);
                localStorage.setItem('confessions', data);
                localStorage.setItem('frontend_confessions', data);
                localStorage.setItem('user_confessions', data);
                
                // æ·»åŠ è°ƒè¯•æ—¥å¿—
                console.log(`ä¿å­˜äº† ${this.confessions.length} æ¡è¡¨ç™½åˆ°æœ¬åœ°å­˜å‚¨`);
            }

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è¡¨ç™½
            loadConfessions() {
                // å°è¯•ä»å¤šä¸ªå¯èƒ½çš„é”®åŠ è½½è¡¨ç™½æ•°æ®
                let savedConfessions = null;
                const possibleKeys = ['confessions', 'frontend_confessions', 'user_confessions'];
                
                for (const key of possibleKeys) {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            savedConfessions = JSON.parse(data);
                            if (savedConfessions && savedConfessions.length > 0) {
                                console.log(`ä» ${key} åŠ è½½åˆ° ${savedConfessions.length} æ¡è¡¨ç™½`);
                                break;
                            }
                        } catch (e) {
                            console.error(`è§£æ ${key} å¤±è´¥:`, e);
                        }
                    }
                }
                
                return savedConfessions || [];
            }

            // åˆ·æ–°è¡¨ç™½æ•°æ®
            refreshConfessions() {
                console.log('æ‰‹åŠ¨åˆ·æ–°è¡¨ç™½æ•°æ®...');
                
                // é‡æ–°åŠ è½½æ•°æ®
                this.confessions = this.loadConfessions();
                console.log('åˆ·æ–°åè¡¨ç™½æ•°é‡:', this.confessions.length);
                
                // é‡æ–°æ¸²æŸ“
                this.renderWall();
                
                // æ˜¾ç¤ºæç¤º
                this.showSuccessMessage('æ•°æ®å·²åˆ·æ–°ï¼');
            }
            
            // æ˜¾ç¤ºå†å²è®°å½•
            showHistory() {
                const historyCount = this.confessions.length;
                if (historyCount === 0) {
                    alert('æš‚æ— å†å²è¡¨ç™½è®°å½•');
                    return;
                }
                
                // åˆ›å»ºä¸€ä¸ªç®€å•çš„å†å²è®°å½•æ˜¾ç¤º
                const historyWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
                historyWindow.document.write(`
                    <html>
                    <head>
                        <title>è¡¨ç™½å†å²è®°å½•</title>
                        <style>
                            body { font-family: 'Microsoft YaHei', sans-serif; margin: 20px; }
                            h1 { color: #667eea; }
                            .confession { border-bottom: 1px solid #eee; padding: 15px 0; }
                            .confession-header { font-weight: bold; color: #333; }
                            .confession-content { margin: 10px 0; line-height: 1.6; }
                            .confession-footer { color: #888; font-size: 14px; }
                        </style>
                    </head>
                    <body>
                        <h1>è¡¨ç™½å†å²è®°å½• (${historyCount}æ¡)</h1>
                        ${this.confessions.map(c => `
                            <div class="confession">
                                <div class="confession-header">è‡´: ${c.to} â€”â€” æ¥è‡ª: ${c.from}</div>
                                <div class="confession-content">${c.content}</div>
                                <div class="confession-footer">æ—¶é—´: ${c.timestamp} | ç±»å‹: ${c.type}</div>
                            </div>
                        `).join('')}
                    </body>
                    </html>
                `);
                historyWindow.document.close();
            }
            
            // åŠ è½½å†å²æ¶ˆæ¯
            loadHistoryMessages() {
                const savedMessages = localStorage.getItem('historyMessages');
                return savedMessages ? JSON.parse(savedMessages) : [];
            }
        }

        // åˆå§‹åŒ–è¡¨ç™½å¢™
        let confessionWall;
        
        document.addEventListener('DOMContentLoaded', () => {
            confessionWall = new ConfessionWall();
        });
    </script>
</body>
</html>